<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="14.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003" DefaultTargets="Build">
  <Import Project="$([MSBuild]::GetDirectoryNameOfFileAbove($(MSBuildThisFileDirectory), dir.props))\dir.props" />
  <PropertyGroup>
      <RestoreOutputPath>$(SourceDir)Common\CoreFX\obj</RestoreOutputPath>
      <Language>C#</Language>
      <NugetTargetMoniker>.NETCoreApp,Version=v3.0</NugetTargetMoniker>
      <TargetFramework>netcoreapp3.0</TargetFramework>
      <ContainsPackageReferences>true</ContainsPackageReferences>
      <CLRTestKind>SharedLibrary</CLRTestKind>
      <IsTestProject>false</IsTestProject>
      <MicrosoftDiagnosticsRuntimePackageVersion>1.0.5</MicrosoftDiagnosticsRuntimePackageVersion>
  </PropertyGroup>

  <!-- Switch RuntimeIdentifier according to currently targeted OSGroup -->
  <PropertyGroup>
      <RuntimeIdentifier Condition="'$(OSGroup)' == 'Windows_NT'">win-x64</RuntimeIdentifier>
      <RuntimeIdentifier Condition="'$(OSGroup)' == 'Linux'">linux-x64</RuntimeIdentifier>
      <RuntimeIdentifier Condition="'$(OSGroup)' == 'OSX'">osx-x64</RuntimeIdentifier>
      <NugetRuntimeIdentifier>$(RuntimeIdentifier)</NugetRuntimeIdentifier>
  </PropertyGroup>

  <ItemGroup>
    <!-- Microsoft.Private.CoreFx.OOB is a meta-package that contains references to most of what we need -->
    <PackageReference Include="Microsoft.Private.CoreFx.OOB">
      <Version>$(MicrosoftPrivateCoreFxNETCoreAppVersion)</Version>
    </PackageReference>

    <!-- The following are needed and seem to be missing from Microsoft.Private.CoreFx.OOB, either intentionally
         or not.
    -->
    <PackageReference Include="Microsoft.Diagnostics.Runtime">
      <Version>$(MicrosoftDiagnosticsRuntimePackageVersion)</Version>
    </PackageReference>
    <PackageReference Include="System.Text.Encoding.CodePages">
      <Version>$(MicrosoftPrivateCoreFxNETCoreAppVersion)</Version>
    </PackageReference>
  </ItemGroup>

  <Import Project="$([MSBuild]::GetDirectoryNameOfFileAbove($(MSBuildThisFileDirectory), dir.targets))\dir.targets" />
  <PropertyGroup>
    <ProjectAssetsFile>$(SourceDir)Common\CoreFX\obj\project.assets.json</ProjectAssetsFile>
  </PropertyGroup>
</Project>
